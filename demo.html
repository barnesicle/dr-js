<!-- This html file is used as the template for how a client uses DigitalRiverPayments -->
<!-- DigitalRiver JS is injected into head by webpack<head>-->
<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8"/>
  <title>Client Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="//unpkg.com/axios/dist/axios.min.js"></script>
  <script src="//cdn.polyfill.io/v3/polyfill.js?ver=5.1.1" type="text/javascript"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
        integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
  <style>
    .xsmall {
      font-size: 60%;
      margin: 0 20px;
    }

    #response {
      border: 1px solid deepskyblue;
      margin: 20px;
      padding: 20px;
      height: 80%;
      overflow: auto;
      overflow-wrap: break-word;
    }

    .ccIcons {
      color: #ddd;
      font-size: 2.3em;
      margin: -.5rem 0 .2rem 3px;
    }

    .ccIcons .active {
      color: #007bff;
    }

    #ccError, #expError, #cvvError {
      margin: -.5rem 0 .2rem 3px;
    }

    .DRElement {
      border:1px solid #ced4da;
      margin:0 0.2rem;
      border-radius:.25rem;
      overflow:hidden;
    }

    #apple-pay.DRElement,
    #google-pay.DRElement {
      border: none;
    }

    .custom--base, .myCustomBase2, .cc--base {
      border:1px solid #ced4da;
      margin:0 0.2rem;
      border-radius:.25rem;
      overflow:hidden;
    }

    .DRElement--focus {
      border-color: #80bdff;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    }

    .custom--focus, .cc--focus {
      border-color: #80bdff;
      background-color: rgba(128, 189, 255, 0.5);
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    }

    .DRElement--invalid {
      border-color: #dc3545;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.31);
    }

    .custom--invalid, .cc--invalid {
      border-color: #dc3545;
      background-color: rgba(220, 53, 69, 0.5);
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.31);
    }

    .DRElement--complete, .cc--complete {
      border-color: #28a745;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.31);
    }

    .custom--complete {
      border-color: #28a745;
      background-color: rgba(40, 167, 69, 0.51);
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.31);
    }

    .DRElement--empty {
      border-color: #db4518;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(219, 69, 24, 0.31);
    }

    .custom--empty, .cc--empty {
      border-color: #db4518;
      background-color: rgba(219, 69, 24, 0.5);
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(219, 69, 24, 0.31);
    }

    .DRElement--webkit-autofill {
      border-color: #4e20db;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(78, 32, 219, 0.31);
    }

    .custom--webkit-autofill {
      border-color: #4e20db;
      background-color: rgba(78, 32, 219, 0.5);
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(78, 32, 219, 0.31);
    }
    #apple-pay {
      height: 42px;
    }
    #ibp {
      position:absolute;
      width: calc(100% - 32px);
      z-index:100;
      background-color: #fff;
    }
    .footer {
      color: white;
      background-color: black;
      height: 80px;
      margin-top: 80px;
      margin-bottom: 0;
    }

    .complianceLink {
      width: auto;
      padding: 2px;
      text-align: center;
      margin-right: 15px;
      line-height: 30px;
      height: 30px;
    }

    .complianceCancellationLink {
      width: 160px;
    }

  </style>
<script defer src="dropInStyles.js"></script><script defer src="DigitalRiver.js"></script><link href="css/DigitalRiver.css" rel="stylesheet"></head>

<body class="bg-light" style="padding-top:50px;">
<div class="row">
  <div class="col-md-8">
    <div class="container">
      <div class="py-5 text-center">
        <h2>Checkout form</h2>
        <span style="color:red" id="message"></span>
        <p class="lead"></p>
      </div>
      <div class="row">
        <div class="col-md-4 order-md-2 mb-4">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">Your cart</span>
            <span class="badge badge-secondary badge-pill" id="cartQuantity">2</span>
          </h4>
          <ul class="list-group mb-3" id="cartItems">

            <!-- CART ITEMS GO HERE -->

            <div id="lineItems">
              <li class="list-group-item d-flex justify-content-between lh-condensed">
                <div>
                  <h6 class="my-0">Digital River Internet Security For PC</h6></div>
                <span class="text-muted">$23.99</span>
              </li>
              <li class="list-group-item d-flex justify-content-between lh-condensed">
                <div>
                  <h6 class="my-0">Digital River Laptop</h6></div>
                <span class="text-muted">$849.99</span>
              </li>
            </div>

            <li class="list-group-item d-flex justify-content-between" style="margin-top:30px;">
              <span>Subtotal</span>
              <strong id="subtotalWithoutDiscount">$873.98</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Subtotal with Discount</span>
              <strong id="subtotalWithDiscountPrice">$873.98</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Shipping</span>
              <strong id="shippingPrice">$5.00</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Tax</span>
              <strong id="taxPrice">$35.16</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Total (USD)</span>
              <strong id="totalPrice">$914.14</strong>
            </li>
          </ul>
        </div>

        <div class="col-md-8 order-md-1">
          <div id="accordion">
            <div class="card">
              <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                  <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true"
                          aria-controls="collapseOne">
                    Address Information
                  </button>
                  <div class="xsmall" id="addressInfo"></div>
                </h5>
              </div>

              <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-body">
                  <form class="needs-validation" novalidate="" id="address-form">
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="firstName">First name</label>
                        <input type="text" class="form-control" id="firstName" placeholder="" value="" required="">
                        <div class="invalid-feedback">
                          Valid first name is required.
                        </div>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="lastName">Last name</label>
                        <input type="text" class="form-control" id="lastName" placeholder="" value="" required="">
                        <div class="invalid-feedback">
                          Valid last name is required.
                        </div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="email">Email Address</label>
                      <input type="text" class="form-control" id="email" placeholder="example@example.com" required="">
                      <div class="invalid-feedback">
                        Please enter your email address.
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="email">Phone Number</label>
                      <input type="tel" class="form-control" id="phone" placeholder="9522253226" required="">
                      <div class="invalid-feedback">
                        Please enter your email address.
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="address">Address</label>
                      <input type="text" class="form-control" id="address" placeholder="1234 Main St" required="">
                      <div class="invalid-feedback">
                        Please enter your shipping address.
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
                      <input type="text" class="form-control" id="address2" placeholder="Apartment or suite">
                    </div>
                    <div class="mb-3">
                      <label for="country">Country</label>
                      <select class="custom-select d-block w-100" id="country" onchange="updateFields(this)" required="">
                        <option value="">Choose...</option>
                        <option value="AU">AU</option>
                        <option value="US">US</option>
                        <option value="FR">FR</option>
                        <option value="DE">DE</option>
                        <option value="KR">KR</option>
                        <option value="JP">JP</option>
                        <option value="NL">NL</option>

                      </select>
                      <div class="invalid-feedback">
                        Please select a valid country.
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4 mb-3">
                        <label for="city">City</label>
                        <input type="text" class="form-control" id="city" placeholder="" required="">
                        <div class="invalid-feedback">
                          City is required.
                        </div>
                      </div>
                      <div class="col-md-4 mb-3">
                        <label for="state">State</label>
                        <select class="custom-select d-block w-100" id="state" required="">
                          <option value="">Choose...</option>
                          <optgroup label="US States">
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District Of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                          </optgroup>
                          <optgroup label="France States">
                            <option value="Ile-de-France">Île-de-France</option>
                          </optgroup>
                          <optgroup label="Korean States">
                            <option value="Jeju Do">Jeju Do</option>
                          </optgroup>
                          <optgroup label="Japan States">
                            <option value="Tokyo">Tokyo</option>
                            <option value="Kyongsangnamdo">Kyongsangnamdo</option>
                          </optgroup>
                        </select>
                        <div class="invalid-feedback">
                          Please provide a valid state.
                        </div>
                      </div>
                      <div class="col-md-3 mb-3">
                        <label for="zip">Zip</label>
                        <input type="text" class="form-control" id="zip" placeholder="" required="">
                        <div class="invalid-feedback">
                          Zip code required.
                        </div>
                      </div>
                    </div>
                    <hr class="mb-4">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="same-address" checked="">
                      <label class="custom-control-label" for="same-address">Shipping address is the same as my billing
                        address</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="save-info">
                      <label class="custom-control-label" for="save-info">Save this information for next time</label>
                    </div>
                    <hr class="mb-4">
                    <input type="hidden" id="phoneNumber">
                    <button class="btn btn-primary btn-lg btn-block" onclick="addAddress(event)" type="submit">Add Address
                    </button>
                  </form>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header" id="headingTwo">
                <h5 class="mb-0">
                  <button id="paymentLink" class="btn btn-link collapsed" data-toggle="collapse"
                          data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Payment Information
                  </button>
                  <div class="xsmall" id="paymentInfo"></div>
                </h5>
              </div>
              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                <div class="card-body">
                  <div class="row">
                    <div id="apple-pay" class="col-md-6 mb-3">
                      <!--apple pay loads here-->
                    </div>
                  </div>
                  <form id="payment-form">
                    <div class="row" id="creditCardPanel">
                      <div class="col-md-6 mb-3 paymentElement">
                        <label>Credit Card Number</label>
                        <div id="ccError" class="text-danger"><!--error messages will go here--></div>
                        <div class="ccIcons">
                          <i id="visa" class="fab fa-cc-visa"></i>
                          <i id="mastercard" class="fab fa-cc-mastercard"></i>
                          <i id="amex" class="fab fa-cc-amex"></i>
                          <i id="discover" class="fab fa-cc-discover"></i>
                          <i id="jcb" class="fab fa-cc-jcb"></i>
                          <i id="dinersclub" class="fab fa-cc-diners-club"></i>
                        </div>
                        <div id="cardnumber" class="myCustomClass"></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3 paymentElement">
                        <label>Expiration Date</label>
                        <div id="expError" class="text-danger"><!--error messages will go here--></div>
                        <div id="cardexpiration" class="myCustomClass"></div>
                      </div>
                      <div class="col-md-6 mb-3 paymentElement">
                        <label>CVV</label>
                        <div id="cvvError" class="text-danger"><!--error messages will go here--></div>
                        <div id="cardcvv" class="myCustomClass"></div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                        <div id="google-pay"></div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                        <div id="paypal-btn"></div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                        <button id="ddButton" class="btn btn-primary btn-lg btn-block" type="submit" onclick="ddGetSource()">Pay with Direct Debit (FR)
                        </button>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                        <button id="wtButton" class="btn btn-primary btn-lg btn-block" type="submit" onclick="wtGetSource()">Pay with Wire Transfer
                        </button>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                        <button id="paycoButton" class="btn btn-primary btn-lg btn-block" type="submit" onclick="commonGetSource('payco','KRW')">Pay with Payco (Korea)
                        </button>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                        <button id="japanCODButton" class="btn btn-primary btn-lg btn-block" type="submit" onclick="commonGetSource('codJapan', 'JPY')">Pay with Japan COD
                        </button>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                        <div>
                          <div id="offlinerefund"></div>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                        <div id="ibp">
                          <div id="ibpbanks"></div>
                        </div>
                      </div>
                    </div>
                    <br /><br /><br />
                    <div class="row">
                      <div class="col-md-12 mb-3 paymentElement">
                          <div>
                              <div id="konbini"></div>
                          </div>
                      </div>
                    </div>


                    <hr class="mb-4">
                    <button id="addPaymentButton" class="btn btn-primary btn-lg btn-block" type="submit" onclick="addPayment()">Add Payment
                    </button>
                  </form>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header" id="headingThree">
                <h5 class="mb-0">
                  <button id="complianceLink" class="btn btn-link collapsed" data-toggle="collapse"
                          data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Compliance Information
                  </button>
                  <div class="xsmall" id="complianceInfo"></div>
                </h5>
              </div>
              <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-4 mb-3">
                      <label for="bEntity">Business Entity</label>
                      <select class="custom-select d-block w-100" id="bEntity" required="">
                        <option value="">Choose...</option>
                        <option value="DR_INC-ENTITY">DR_INC-ENTITY</option>
                        <option value="C5_INC-ENTITY">C5_INC-ENTITY</option>
                        <option value="DR_WP-ENTITY">DR_WP-ENTITY</option>
                        <option value="DR_WPAB-ENTITY">DR_WPAB-ENTITY</option>
                        <option value="DRES_INC-ENTITY">DRES_INC-ENTITY</option>
                        <option value="DR_BRAZIL-ENTITY">DR_BRAZIL-ENTITY</option>
                        <option value="DR_CHINA-ENTITY">DR_CHINA-ENTITY</option>
                        <option value="DR_GMBH-ENTITY">DR_GMBH-ENTITY</option>
                        <option value="DR_INDIA-ENTITY">DR_INDIA-ENTITY</option>
                        <option value="DR_IRELAND-ENTITY">DR_IRELAND-ENTITY</option>
                        <option value="DR_JAPAN-ENTITY">DR_JAPAN-ENTITY</option>
                        <option value="DR_KOREA-ENTITY">DR_KOREA-ENTITY</option>
                        <option value="DR_MEXICO-ENTITY">DR_MEXICO-ENTITY</option>
                        <option value="DR_RUSSIA-ENTITY">DR_RUSSIA-ENTITY</option>
                        <option value="DR_TAIWAN-ENTITY">DR_TAIWAN-ENTITY</option>
                        <option value="DR_SARL-ENTITY">DR_SARL-ENTITY</option>
                      </select>
                    </div>
                    <div class="col-md-4 mb-3">
                      <label for="locale">Locale</label>
                      <select class="custom-select d-block w-100" id="locale" required="">
                        <option value="">Choose...</option>
                        <option value="es-419">es-419</option>
                        <option value="de">de</option>
                        <option value="invalid">invalid</option>
                        <option value="ar-EG">ar-EG</option>
                        <option value="ar-EG">ar-EG</option>
                        <option value="cs-CZ">cs-CZ</option>
                        <option value="da-DK">da-DK</option>
                        <option value="de-AT">de-AT</option>
                        <option value="de-CH">de-CH</option>
                        <option value="de-DE">de-DE</option>
                        <option value="el-GR">el-GR</option>
                        <option value="en-AU">en-AU</option>
                        <option value="en-BE">en-BE</option>
                        <option value="en-CA">en-CA</option>
                        <option value="en-CH">en-CH</option>
                        <option value="en-DK">en-DK</option>
                        <option value="en-FI">en-FI</option>
                        <option value="en-GB">en-GB</option>
                        <option value="en-IE">en-IE</option>
                        <option value="en-IN">en-IN</option>
                        <option value="en-MY">en-MY</option>
                        <option value="en-NL">en-NL</option>
                        <option value="en-NO">en-NO</option>
                        <option value="en-NZ">en-NZ</option>
                        <option value="en-PR">en-PR</option>
                        <option value="en-SE">en-SE</option>
                        <option value="en-SG">en-SG</option>
                        <option value="en-US">en-US</option>
                        <option value="en-ZA">en-ZA</option>
                        <option value="en-AR">en-AR</option>
                        <option value="en-CL">en-CL</option>
                        <option value="en-CO">en-CO</option>
                        <option value="en-EC">en-EC</option>
                        <option value="en-ES">en-ES</option>
                        <option value="en-MX">en-MX</option>
                        <option value="en-PE">en-PE</option>
                        <option value="en-VE">en-VE</option>
                        <option value="et-EE">et-EE</option>
                        <option value="fi-FI">fi-FI</option>
                        <option value="fr-BE">fr-BE</option>
                        <option value="fr-CA">fr-CA</option>
                        <option value="fr-CH">fr-CH</option>
                        <option value="fr-FR">fr-FR</option>
                        <option value="hu-HU">hu-HU</option>
                        <option value="it-CH">it-CH</option>
                        <option value="it-IT">it-IT</option>
                        <option value="iw-IL">iw-IL</option>
                        <option value="ja-JP">ja-JP</option>
                        <option value="ko-KP">ko-KR</option>
                        <option value="lt-LT">lt-LT</option>
                        <option value="lv-LV">lv-LV</option>
                        <option value="nl-BE">nl-BE</option>
                        <option value="nl-NL">nl-NL</option>
                        <option value="no-NO">no-NO</option>
                        <option value="pl-PL">pl-PL</option>
                        <option value="pt-BR">pt-BR</option>
                        <option value="pt-PT">pt-PT</option>
                        <option value="ro-RO">ro-RO</option>
                        <option value="ru-RU">ru-RU</option>
                        <option value="sk-SK">sk-SK</option>
                        <option value="sl-SI">sl-SI</option>
                        <option value="sr-YU">sr-YU</option>
                        <option value="sv-SE">sv-SE</option>
                        <option value="th-TH">th-TH</option>
                        <option value="tr-TR">tr-TR</option>
                        <option value="zh-CN">zh-CN</option>
                        <option value="zh-HK">zh-HK</option>
                        <option value="zh-TW">zh-TW</option>
                      </select>
                    </div>
                  </div>
                  <button class="btn btn-primary btn-lg btn-block" onclick="complianceData()" type="submit">Get Compliance Details</button>
                  <br/>
                  <div class="row" id="complianceMethod"></div>
                  <div id="compliance-details"></div>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header" id="headingFour">
                <h5 class="mb-0">
                  <button id="taxLink" class="btn btn-link collapsed" data-toggle="collapse"
                          data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                    Tax Information
                  </button>
                  <div class="xsmall" id="taxInfo"></div>
                </h5>
              </div>
              <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">
                <div class="card-body">
                  <div class="row">
                  </div>
                  <div id="tax-identifier"></div>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header" id="headingFive">
                <h5 class="mb-0">
                  <button id="ibanLink" class="btn btn-link collapsed" data-toggle="collapse"
                          data-target="#collapseFive" aria-expanded="false" aria-controls="collapseFour">
                    IBAN
                  </button>
                </h5>
              </div>
              <div id="collapseFive" class="collapse" aria-labelledby="headingFive" data-parent="#accordion">
                <div class="card-body">
                  <div class="row">
                  </div>
                  <div id="iban"></div>
                  <p>example NL IBAN: NL91ABNA0417164300</p>
                  <button id="createIdealSource" onClick="createIdealSource()">Create iDeal Source with IBAN</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div id="source" style="display:none"></div>
            <div id="card-errors"></div>
          </div>
          <div class="row" id="submitPayment">
            <div class="col-md-12">
              <br/>
              <button id="submitPaymentButton" class="btn btn-primary btn-lg btn-block" onclick="submitCreditCardPayment()">Submit CC Payment</button>
              <button id="submitStoredPaymentButton" class="btn btn-primary btn-lg btn-block" onclick="submitStoredCreditCardPayment()">Submit STORED CC Payment</button>
              <button id="submitPaymentButtonWith3DS" class="btn btn-secondary btn-lg btn-block" onclick="submitCreditCardPaymentWithSessionId()">Submit CC Payment with 3DS</button>
              <button id="submitIBPPaymentButton" class="btn btn-primary btn-lg btn-block" onclick="submitIbpPayment()">Submit IBP Payment</button>
              <button id="submitKonbiniPaymentButton" class="btn btn-primary btn-lg btn-block" onclick="submitKonbiniPayment()">Submit Konbini</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <button onclick="getDEBanks()">get banks for DE</button>
    <button onclick="creditCardNumberComponent.clear()">clear ccnum</button>
    <button onclick="creditCardNumberComponent.focus(); setTimeout(function() {creditCardNumberComponent.blur()}, 2000)">focus ccnum, then blur</button>
    <button onclick="ibpBanksComponent.focus(); setTimeout(function() {ibpBanksComponent.blur()}, 2000)">focus ibp, then blur</button>
    <button onclick="ibpBanksComponent.update({
      style: styles,
      onlineBanking: { currency: 'EUR', country: 'AT' },
      placeholderText: 'Select an AT bank'
    });">update ibp to AT</button>
      <button onclick="ibpBanksComponent.update({
      style: styles,
      onlineBanking: { currency: 'EUR', country: 'DE' },
      placeholderText: 'Select a DE bank'
    });">update ibp to DE</button>
    <button onclick="creditCardNumberComponent.update({placeholderText: 'Number', classes: {base:'myCustomBase2'}, style: { base: {'::placeholder': {color:'red'}}, complete: {color: 'white'}}})">update ccnum options</button>
    <button onclick="creditCardNumberComponent.update({style: { base: {'::placeholder': {color:'green'}}}})">update ccnum again</button>
    <button onclick="creditCardNumberComponent.unmount();">unmount ccnum</button>
    <button onclick="creditCardNumberComponent.mount('cardnumber');">remount ccnum</button>
    <button onclick="creditCardNumberComponent.destroy()">destroy ccnum</button>
    <div>
      <button onclick="applePayComponent.show()">show applepay sheet</button>
      <button onclick="applePayComponent.update(updatedAppleInfo)">update applePay</button>
      <button onclick="googlePayComponent.show()">show googlepay sheet</button>
      <button onclick="googlePayComponent.update(googlePayUpdatePaymentRequest)">googlepay update</button>
    </div>
    <div>
      <button onclick="destroyField()">Remove Card Number field</button>
      <button onclick="recreateField()">Re-create Card Number field</button>
    </div>
    <div>
      <button onclick="retrieveSourceDemo()">Retrieve valid source </button>
      <button onclick="retrieveBadSourceDemo()">Retrieve invalid source </button>
    </div>
  </div>

  <div class="col-md-4 console">
    <pre id="response"></pre>
  </div>
</div>
<div class="footer">

</div>
<!--<script src="https://www.paypalobjects.com/api/checkout.js"></script>-->
<script type="text/javascript">
  // let apiKey = 'pk_sys_c2608001bba7477eae22808e1eb138db';
  //let apiKey = 'pk_test_d6b3712c81c640288142f204a88f3de5'; // NOTE: Use this key for paypal for test mode / to display mock page
  //let apiKey = 'cc203ec2d74e4002a7e341abd6df6eb5'; // DoDJS15
  //let apiKey = 'pk_d8013e0122b84103be7b1db903437a46'; //paylive prod key
  //let apiKey = 'pk_hc_b230cec5ef7c44a992af0bcf180ccfaf'; //paylive test key
  //let apiKey = 'pk_test_d6b3712c81c640288142f204a88f3de5'; //headless nonprod
  //let apiKey = 'pk_hc_805a0837ed6a43f5af99caebcddd2b6e'; //test3ds
  let apiKey = 'pk_sys_c2608001bba7477eae22808e1eb138db'; //payservice systest
  let digitalRiverPayments;
  let digitalRiverPayments2;
  let digitalRiverPayments3;

  let owner = {};
  let response = document.getElementById('response');

  let creditCardNumberComponent;
  let creditCardExpiryComponent;
  let creditCardCvvComponent;
  let googlePayComponent;
  let applePayComponent;
  let ibpBanksComponent;
  let konbiniComponent;
  let paypalComponent;
  let complianceComponent;
  let taxIdentifierComponent;
  let ibanComponent;

  let googlePayPaymentRequest;
  let googlePayUpdatePaymentRequest;

  let updatedAppleInfo;

  let ccNumComplete = false;
  let ccExpirationComplete = false;
  let ccCVVComplete = false;

  let taxIdentifierComponentData = {};

  let styles = {
    base: {
      padding: '0',
      color: '#495057',
      height: '35px',
      fontSize: '1rem',
      fontFamily: 'apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif',
      // fontWeight: 'lighter',
      ':hover': {
        color: '#137bee',
      },
      '::placeholder': {
        color: '#999'
      },
      ':-webkit-autofill': {
        color: 'purple'
      },
      ':focus': {
        color: 'blue'
      }
    },
    invalid: {
      color: '#dc3545',
      ':-webkit-autofill': {
        color: '#dc3545'
      }
    },
    complete: {
      color: '#28a745',
      ':hover': {
        color:'#28a745',
      },
      ':-webkit-autofill': {
        color: '#28a745'
      }
    },
    empty: {
      color: '#000000'
      /*color: '#db4518',
      ':hover': {
        color: '#db4518'
      },
      '::placeholder': {
        color: '#db4518'
      }*/
    },

  };

  let ccNumOptions = {
    placeholderText: 'Credit Card Number',
    style: styles,
    classes: {
      base: 'custom--base',
      focus: 'custom--focus',
      invalid: 'custom--invalid',
      empty: 'custom--empty',
      complete: 'custom--complete',
      webkitAutofill: 'custom--webkit-autofill'
    },
    mask: true
  };

  let sessionClientSecret = ''; // Gets set from API and passed into create source for 3DS

  function mockFetch() {
    return new Promise(function(resolve) {
      setTimeout(function() {
        resolve();
      }, 1000);
    });
  }

  function getDefaultGooglePayData() {

    const lineItems = [
      {
        label: "Some Product",
        amount: 10,
        isPending: false
      },
      {
        label: "Discount (20% off)",
        amount: 5,
        isPending: false
      },
      {
        label: "Sales Tax",
        amount: 3,
        isPending: true
      }
    ];

    const shippingOptions = [
      {
        id: "free-shipping",
        label: "Free Shipping",
        amount: 0,
        detail: "Will arrive in a few days"
      },
      {
        id: "overnight-shipping",
        label: "Overnight Shipping",
        amount: 10,
        detail: "Will arrive tomorrow morning"
      }
    ];

    return {
      country: "us",
      currency: "USD",
      total: {
        label: "Order Total",
        amount: 6.20,
        isPending: true
      },
      displayItems: lineItems,
      shippingOptions: shippingOptions,
      requestShipping: true,
      style: {
        buttonType: "plain",
        buttonColor: "light",
        buttonLanguage: "en"
      },
      waitOnClick: true
    };

  }

  function getURLParamOrDefault(name, defaultValue) {
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results == null){
      return defaultValue;
    }
    else {
      return decodeURI(results[1]) || 0;
    }
  }


  function onLoad() {
    var isIE = !!window.MSInputMethodContext && !!document.documentMode;
    //console.log(isIE);
    if(navigator.userAgent.indexOf('MSIE')!==-1
            || navigator.appVersion.indexOf('Trident/') > -1){
      isIE = true;
      /* Microsoft Internet Explorer detected in. */
    }
    if(!isIE) {
      let urlParams = new URLSearchParams(window.location.search);

      if(urlParams.get('sourceId')) {
        responseLog('Shopper has returned from redirect. <br/> sourceId ' + urlParams.get('sourceId') + ' can now be used for payment');
      }

    }

    const options = { locale: getURLParamOrDefault('locale','en-US'), customerID: 'customer-id-123'};
    digitalRiverPayments = new DigitalRiver(apiKey, options);
    digitalRiverPayments2 = new DigitalRiver(apiKey, options);
    digitalRiverPayments3 = new DigitalRiver('pk_test_9ad06f842d02401d8919995225efeb46', options);

    let ccExpirationOptions = {
      placeholderText: 'MM/YY',
      style: styles
    };
    let ccCVVOptions = {
      placeholderText: 'CVV',
      style: styles,
      mask: true
    };


    googlePayPaymentRequest = digitalRiverPayments.paymentRequest(getDefaultGooglePayData());

    const googlePayUpdateData = getDefaultGooglePayData();

    googlePayUpdateData.style.buttonType = 'long';
    googlePayUpdateData.style.buttonColor = 'dark';
    googlePayUpdateData.style.buttonLanguage = 'de';
    googlePayUpdateData.total.label = 'Order Total - from update call';
    googlePayUpdateData.waitOnClick = true;
    googlePayUpdatePaymentRequest = googlePayUpdateData;

    const shippingOptions = [
      {
        id: "free-shipping",
        label: "Free Shipping",
        amount: 0,
        detail: "Will arrive in a few days",
        // added selected attribute as string instead of boolean to verify DR js converting them to boolean.
        selected: "true"
      },
      {
        id: "ground",
        label: "Ståndard Shipping",
        amount: 5,
        detail: "Will arrive in a few days",
        selected: true
      },
      {
        id: "overnight-shipping",
        label: "Overnîght Shipping",
        amount: 10,
        detail: "Will arrive tomorrow morning",
        // added selected attribute as string instead of boolean to verify DR js converting them to boolean.
        selected: "false"
      }
    ];

    const applePayPaymentRequest = digitalRiverPayments.paymentRequest({
      country: "us",
      currency: "USD",
      total: {
        label: "Your Order Total",
        amount: 1,
        isPending: false
      },
      displayItems: [
        {
          label: "Subtotal",
          amount: 1,
          isPending: false
        },
        {
          label: "Shipping",
          amount: 0,
          isPending: false
        }
      ],
      //shippingOptions: shippingOptions,
      requestShipping: false,
      style: {
        buttonType: "plain",
        buttonColor: "dark",
        buttonLanguage: "en"
      },
      waitOnClick: true
    });

    updatedAppleInfo = {
      total: {
        label: "Order Total after update",
        amount: 2,
        isPending: false
      },
      displayItems: [
        {
          label: "subtotal after update",
          amount: 1,
          isPending: false
        },
        {
          label: "shipping after update",
          amount: 0,
          isPending: false
        }
      ],
      style: {
        buttonType: "buy",
        buttonColor: "light",
        buttonLanguage: "fr"
      }
    };

    document.getElementById('addPaymentButton').setAttribute("disabled", "disabled");

    console.log(googlePayPaymentRequest);
    console.log(applePayPaymentRequest);

    // Initialize DRP library
    creditCardExpiryComponent = digitalRiverPayments.createElement('cardexpiration', ccExpirationOptions);
    creditCardCvvComponent = digitalRiverPayments.createElement('cardcvv', ccCVVOptions);

    ibpBanksComponent = digitalRiverPayments.createElement('onlinebanking', {
      style: styles,
      onlineBanking: { currency: 'EUR', country: 'DE' }
    });

    googlePayComponent = digitalRiverPayments.createElement('googlepay', googlePayPaymentRequest);
    applePayComponent = digitalRiverPayments.createElement('applepay', applePayPaymentRequest);

    konbiniComponent = digitalRiverPayments.createElement('konbini', {
      style: styles,
    });

    complianceComponent =  digitalRiverPayments.createElement('compliance', {
      classes: {
        base: 'DRElement-Compliance'
      },
      compliance: {
        locale: 'en-US',
        entity: 'DR_INC-ENTITY'
      }
    });

    taxIdentifierComponent =  digitalRiverPayments3.createElement('taxidentifier', {
      style: styles,
      classes: {
        base: 'cc--base',
        focus: 'cc--focus',
        invalid: 'cc--invalid',
        empty: 'cc--empty',
        complete: 'cc--complete',
        webkitAutofill: 'cc--webkit-autofill'
      },
      taxIdentifier: {
        // "sessionId": "78c37d07-c20c-4be3-aac9-4438aaa40f27", // Has selling entityID : "99b8a047-544e-4ccb-8376-04088b241206",
        type: getURLParamOrDefault('taxIdentifierType', undefined),
        country: getURLParamOrDefault('country', 'IT'),
        sellingEntity: getURLParamOrDefault('sellingEntity', 'DR_IRELAND-ENTITY')
      }
    });

    ibanComponent = digitalRiverPayments.createElement('iban', {styles: styles});
    ibanComponent.mount('iban');

    ibanComponent.on('ready', (data) => {responseLog('iban ready: \n' + JSON.stringify(data));});
    ibanComponent.on('change', (data) => {responseLog('iban change: \n' + JSON.stringify(data));});
    ibanComponent.on('blur', (data) => {responseLog('iban blur: \n' + JSON.stringify(data));});
    ibanComponent.on('focus', (data) => {responseLog('iban focus: \n' + JSON.stringify(data));});

    console.log('Calling mount functions');

    creditCardExpiryComponent.mount("cardexpiration");
    creditCardCvvComponent.mount("cardcvv");
    ibpBanksComponent.mount('ibpbanks');
    konbiniComponent.mount('konbini');
    complianceComponent.mount('compliance-details');
    taxIdentifierComponent.mount('tax-identifier');

    if (googlePayComponent.canMakePayment()) {
      googlePayComponent.mount("google-pay");

      googlePayComponent.on('ready', function(event) {
        responseLog('googlepay ready received ' + JSON.stringify(event));
      });

      googlePayComponent.on('click', function(details) {
        console.log('google pay click')
        responseLog('googlepay click received ' + JSON.stringify(details));
        const updatedDetailsData = {
          total: {
            label: 'Order Total - click event with wait'
          },
          shippingOptions: shippingOptions
        };

        if (details.updateWith) {
          console.log('updateWith google function')
          mockFetch('https://chrismiller1.free.beeceptor.com/') // Call the fetch function passing the url of the API as a parameter
                  .then(function(data) {
                    // Your code for handling the data you get from the API
                    if(details.hasOwnProperty('updateWith')) {
                      details.updateWith(updatedDetailsData)
                    }
                  })
        }
      });

      googlePayComponent.on("source", function (data) {
        responseLog('googlepay source received ' + JSON.stringify(data));
        data.complete('success');
      });

      googlePayComponent.on("shippingaddresschange", function (details) {
        responseLog('googlepay shippingaddresschange received ' + JSON.stringify(details));

        const data = {};
        if (details.shippingAddress.address.country === 'US') {
          data.total = {label: 'Order Total - address change - success'};
          data.shippingOptions = [
            {
              id: "ground",
              label: "Standard Shipping",
              amount: 5,
              detail: "Will arrive in a few days"
            },
            {
              id: "priority-mail-shipping",
              label: "Priority Mail Shipping",
              amount: 10,
              detail: "Will arrive 1-3 days"
            },
            {
              id: "overnight-shipping",
              label: "Overnight Shipping",
              amount: 25,
              detail: "Will arrive tomorrow morning"
            }
          ];
          data.status = 'success';
        } else { // Error!
          data.total = {label: 'Order Total - address change - error'};
          data.status = 'failure';
          data.error = {
            message: "You can only ship to a US address.",
            fields: {
              country: 'Invalid country',
              city: 'Woops. Bad city'
            }
          };
        }

        if (details.updateWith) {
          setTimeout(function () {
            details.updateWith(data)
          }, 1000);
        }
      });

      googlePayComponent.on("shippingoptionchange", function (details) {
        responseLog('googlepay shippingoptionchange received ' + JSON.stringify(details));
        const data = {total : {label: 'Order Total - option change'}};
        data.shippingOptions = [
          {
            id: "ground",
            label: "Standard Shipping",
            amount: 5,
            detail: "Will arrive in a few days"
          },
          {
            id: "priority-mail-shipping",
            label: "Priority Mail Shipping",
            amount: 10,
            detail: "Will arrive 1-3 days"
          }
        ];
        setTimeout(function () {details.updateWith(data)}, 1000);
      });

      googlePayComponent.on('cancel', function(event) {
        responseLog('googlepay session was canceled ');
        responseLog(JSON.stringify(event));
      });

    }

    if (applePayComponent.canMakePayment()) {
      applePayComponent.mount("apple-pay");
    } else {
      document.getElementById('apple-pay').setAttribute('style','display:none');
    }

    applePayComponent.on('shippingaddresschange', function(details) {
      responseLog('applepay shipping address was updated');
      responseLog(JSON.stringify(details));
      setTimeout(function () {
        let updatedDetails = {
          status: 'success',
          shippingOptions: [
            {
              id: "free-shipping 2 ",
              label: "Free Shipping 2",
              amount: 0,
              detail: "Will arrive in a few days",
              selected: true
            },
            {
              id: "overnight-shipping 2",
              label: "Óvêrnight ShiÞþing 2",
              amount: 10,
              detail: "Will arrive tomorrow morning"
            }
          ],
          total: updatedAppleInfo.total,
          style: {
            buttonType: "buy",
            buttonColor: "light",
            buttonLanguage: "fr"
          }
        };
        //failure scenario with error block
        if(details.shippingAddress.address.city === 'Apple Valley') {
          updatedDetails.status = 'failure';
          updatedDetails.error = {
            message: 'An Error has occurred.  Please try again.',
            fields: {
              postalCode: 'Your zip code is crazy bad'
            }
          };
        }

        //failure scenario and error not sent (checking defaults)
        if(details.shippingAddress.address.city === 'Kaladim') {
          updatedDetails.status = 'failure';
        }
        responseLog('sending info back to DR for Apple');
        responseLog(JSON.stringify(updatedDetails));
        fetch('https://jsonplaceholder.typicode.com/todos/1') // Call the fetch function passing the url of the API as a parameter
                .then(function() {
                  // Your code for handling the data you get from the API
                  if(details.hasOwnProperty('updateWith')) {
                    details.updateWith(updatedDetails)
                  };
                })
      }, 2000);
    });
    applePayComponent.on('shippingoptionchange', function(details) {
      responseLog('applepay shipping option was updated');
      responseLog(JSON.stringify(details));
      setTimeout(function () {
        let updatedDetails = {
          status: 'success',
          total: {
            label: "Order Total",
            amount: 3,
            isPending: false
          },
          displayItems: [
            {
              label: "subtotal after shipping method change",
              amount: 3,
              isPending: false
            },
            {
              label: "shipping",
              amount: 0,
              isPending: false
            }
          ]
        };
        fetch('https://jsonplaceholder.typicode.com/todos/1') // Call the fetch function passing the url of the API as a parameter
                .then(function(data) {
                  // Your code for handling the data you get from the API
                  console.log(data);
                  if(details.hasOwnProperty('updateWith')) {
                    console.log('client sending updated shipping option info')
                    details.updateWith(updatedDetails);
                  }
                });
        responseLog('sending info back to DR for Apple');
        responseLog(JSON.stringify(updatedDetails));
      }, 2000);

    });

    applePayComponent.on('ready', function(event) {
      responseLog('applepay ready received ' + JSON.stringify(event));
    });

    applePayComponent.on('click', function(event) {
      responseLog('applepay button was clicked');
      responseLog(JSON.stringify(event));
      setTimeout(function () {
        let updatedDetails = {
          status: 'success',
          displayItems: [
            {
              label: "Subtotal",
              amount: 1,
              isPending: false
            },
            {
              label: "Shipping",
              amount: 1,
              isPending: false
            }
          ],
        };
        // Call the fetch function passing the url of the API as a parameter
        fetch('https://jsonplaceholder.typicode.com/todos/1').then(function(data) {
          // Your code for handling the data you get from the API
          console.log(data);
          if(event.hasOwnProperty('updateWith')) {
            console.log('client sending updated info');
            event.updateWith(updatedDetails);
          };
        });
        responseLog(JSON.stringify(updatedDetails));
      }, 2000);
    });

    applePayComponent.on('cancel', function(event) {
      responseLog('applepay session was canceled');
      responseLog(JSON.stringify(event));
    });

    applePayComponent.on('source', function(event) {
      responseLog('applepay source was created');
      responseLog(JSON.stringify(event));
      event.complete('success');
    });

    // Credit Card Number Listeners
    // this is demonstrating that the client is receiving the event for now.
    creditCardEvents();

    // Credit Card Expiry Listeners
    creditCardExpiryComponent.on('ready', function (event) {
      responseLog('expiration ready received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardExpiryComponent.on('blur', function (event) {
      responseLog('expiration blur received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardExpiryComponent.on('focus', function (event) {
      responseLog('expiration focus received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardExpiryComponent.on('change', function (event) {
      responseLog('expiration change received ' + JSON.stringify(event) + ' for cardexpiration');

      const errorDiv = document.getElementById('expError');
      displayValidation(event, errorDiv, 'Expiration Date');

      ccExpirationComplete = event.complete;
      checkFormComplete();
    });

    creditCardExpiryComponent.on('return', function (event) {
      responseLog('expiration return received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    // Cred Card Security Code Listeners
    creditCardCvvComponent.on('ready', function (event) {
      responseLog('cvv ready received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardCvvComponent.on('blur', function (event) {
      responseLog('cvv blur received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardCvvComponent.on('focus', function (event) {
      responseLog('cvv focus received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardCvvComponent.on('change', function (event) {
      responseLog('cvv change received ' + JSON.stringify(event) + ' for cardcvv');

      const errorDiv = document.getElementById('cvvError');
      displayValidation(event, errorDiv, 'CVV');

      ccCVVComplete = event.complete;
      checkFormComplete();
    });

    creditCardCvvComponent.on('return', function (event) {
      responseLog('cvv return received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    ibpBanksComponent.on('ready', function (event) {
      responseLog( event.elementType + ' ready received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    ibpBanksComponent.on('blur', function (event) {
      responseLog(event.elementType + ' blur received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    ibpBanksComponent.on('focus', function (event) {
      responseLog(event.elementType + ' focus received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    ibpBanksComponent.on('change', function (event) {
      responseLog(event.elementType + ' change received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    konbiniComponent.on('ready', function (event) {
      responseLog( event.elementType + ' ready received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    konbiniComponent.on('blur', function (event) {
      responseLog(event.elementType + ' blur received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    konbiniComponent.on('focus', function (event) {
      responseLog(event.elementType + ' focus received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    konbiniComponent.on('change', function (event) {
      responseLog(event.elementType + ' change received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    complianceComponent.on('ready', function (event) {
      responseLog( event.elementType + ' ready received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    taxIdentifierComponent.on('ready', function (event) {
      responseLog( event.elementType + ' ready received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    taxIdentifierComponent.on('blur', function (event) {
      responseLog(event.elementType + ' blur received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    taxIdentifierComponent.on('focus', function (event) {
      responseLog(event.elementType + ' focus received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    taxIdentifierComponent.on('change', function (event) {
      console.log('CHANGE', event)
      responseLog(event.elementType + ' change received ' + JSON.stringify(event) + ' for ' + event.elementType);
      if (event.complete) {
        taxIdentifierComponentData[event.identifier.type] = {
          value: event.identifier.value,
          type: event.identifier.type,
        }
        console.log('Tax identifier data', taxIdentifierComponentData)
      } else {
        delete taxIdentifierComponentData[event.identifier.type]
        console.log('Tax identifier data', taxIdentifierComponentData)
      }
    });


    // PayPal Button
    payPalBtn(digitalRiverPayments);

  }

  window.onload = onLoad;

  function payPalBtn(digitalRiverPayments) {

    let paypalSourceData = {
      type:'payPal',
      amount: 914.14,
      currency: 'USD',
      payPal: {
        returnUrl : 'https://js-test.digitalriver.com/v1/demo.html',
        cancelUrl: 'https://js-test.digitalriver.com/v1/demo.html',
        items: [
          {
            name: 'Digital River Internet Security for PC',
            quantity: 1,
            unitAmount: '23.99',
          },
          {
            name: 'Digital River Laptop',
            quantity: 1,
            unitAmount: '849.99'
          }
        ],
        taxAmount: 35.16,
        requestShipping: true,
        amountEstimated: true,
        // Optional Attributes
        shippingAmount: 5,
        shipping:{
          recipient: 'Test Data',
          phoneNumber: '9522251234',
          address: {
            line1: '10380 Bren Road West',
            line2: '',
            city: 'Minnetonka',
            state: 'MN',
            country: 'US',
            postalCode: '55343'
          }
        }
      }
    };


    paypalComponent = digitalRiverPayments.createElement('paypal', {
      style: {
        label: 'checkout',
        size: 'responsive',
        color: 'gold',
        shape: 'pill',
        layout: 'horizontal',
        fundingicons: 'false'
      },
      sourceData: paypalSourceData
    });

    paypalComponent.mount('paypal-btn');

    paypalComponent.on('ready', function(event) {
      responseLog('paypal ready received ' + JSON.stringify(event));
    });

    paypalComponent.on('click', function(event) {
      responseLog('paypal click ' + JSON.stringify(event));
    });

    paypalComponent.on('cancel', function(event) {
      responseLog('paypal cancel ' + JSON.stringify(event));
    });

    paypalComponent.on('source', function(event) {
      responseLog('paypal source was created');
      responseLog(JSON.stringify(event));
    });


  }

  function creditCardEvents() {
    creditCardNumberComponent = digitalRiverPayments.createElement('cardnumber', ccNumOptions);
    creditCardNumberComponent.mount("cardnumber");

    creditCardNumberComponent.on('ready', function (event) {
      responseLog('ccnum ready received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardNumberComponent.on('blur', function (event) {
      responseLog('ccnum blur received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardNumberComponent.on('focus', function (event) {
      responseLog('ccnum focus received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

    creditCardNumberComponent.on('change', function (event) {
      responseLog('ccnum change received ' + JSON.stringify(event) + ' for cardnumber');
      highlightCCIcon(event.brand);

      const errorDiv = document.getElementById('ccError');
      displayValidation(event, errorDiv, 'Credit Card');

      ccNumComplete = event.complete;
      checkFormComplete();
    });

    creditCardNumberComponent.on('return', function (event) {
      responseLog('ccnum return received ' + JSON.stringify(event) + ' for ' + event.elementType);
    });

  }

  function responseLog(msg) {
    response.innerHTML += msg + '<br/><br/>';
  }

  function highlightCCIcon(brand) {
    const ccIcons = document.querySelectorAll('.ccIcons .fab');
    for(let i = 0; i < ccIcons.length; i++) {
      let icon = document.getElementById(ccIcons[i].id);
      if(icon.id === brand) {
        icon.classList.add('active');
      } else {
        icon.classList.remove('active');
      }
    }
  }

  function displayValidation(event, errorDiv, fieldName) {
    if(event.error) {
      let errorText = '';
      switch(event.error.code) {
        case 'ELEMENT_DATA_REQUIRED':
          errorText = 'This field is required';
          break;
        case 'ELEMENT_DATA_INCOMPLETE':
          errorText = 'Invalid length for ' + fieldName;
          break;
        case 'ELEMENT_DATA_INVALID':
          errorText = 'Invalid ' + fieldName;
          break;
        case 'ELEMENT_DATA_DATE_IN_PAST':
          errorText = 'Date must be a future date';
          break;
        case 'ELEMENT_DATA_INVALID_MONTH':
          errorText = 'Invalid Month';
          break;
        case 'ELEMENT_DATA_INVALID_NUMBER':
          errorText = 'Card number must be valid';
          break;
        default:
          errorText = event.error.message;
      }
      errorDiv.innerText = errorText;
    } else {
      errorDiv.innerText = '';
    }
  }

  function checkFormComplete() {
    if(ccNumComplete && ccExpirationComplete && ccCVVComplete) {
      document.getElementById('addPaymentButton').removeAttribute("disabled");
    } else {
      document.getElementById('addPaymentButton').setAttribute("disabled", "disabled");
    }
  }

  function addAddress(event) {
    event.preventDefault();
    document.getElementById('paymentLink').click();
    let address = document.getElementById('address-form');
    owner.firstName = address.firstName.value;
    owner.lastName = address.lastName.value;
    owner.email = address.email.value;
    owner.phoneNumber = address.phone.value;
    owner.address = {
      "line1": address.address.value,
      "line2": address.address2.value || '',
      "city": address.city.value,
      "state": address.state.value,
      "country": address.country.value,
      "postalCode": address.zip.value
    };

    document.getElementById('addressInfo').innerHTML = (
            owner.firstName + ' ' + owner.lastName
            + '<br/>'
            + owner.address.line1 + ' ' + owner.address.line2 + '<br/>'
            + owner.address.city + ' ' + owner.address.state + ' ' + owner.address.postalCode
    );

    response.innerHTML += 'gathering user\'s address info...<br/>'

  }

  function addPayment() {
    // right now this just collapses and then displays the submit payment button
    event.preventDefault();
    document.getElementById('paymentLink').click();
    $('#submitPayment').show();
    response.innerHTML += 'gathering user\'s payment info...<br/>'
  }

  function submitCreditCardPayment() {
    // Call CreateSource
    const payload = {
      "type": "creditCard",
      //"usage": "single",
      "owner": owner,
      // "amount": 1.2,
      // "currency": "EUR",
    };

    document.getElementById("response").innerHTML += "Submitting Credit Card payment...please wait<br/>";
    digitalRiverPayments.createSource(creditCardNumberComponent, payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "Credit Card Payment response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "Credit Card Payment response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err)  {
      console.error('createSource failed:', err);
    });
  }

  function createIdealSource() {
    event.stopPropagation();
    const payload = {
      "sessionId": "ec55112b-9eab-4f6e-987f-283cee2d4fa3",
      "type": "ideal",
      "owner": owner,
      "amount": 5,
      "currency": "EUR",
      "ideal": {
        "returnUrl": window.location.href
      }
    };

    digitalRiverPayments.createSource(ibanComponent, payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "iDeal Payment response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "iDeal Payment response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err)  {
      console.error('createSource failed:', err);
    });
  }

  function submitCreditCardPaymentWithSessionId() {
    // Call CreateSource
    const payload = {
      "type": "creditCard",
      "usage": "single",
      "owner": owner,
      "amount": 100,
      "currency": "USD",
      'sessionId': 'dec0f861-7411-44e3-a011-67dd6de0e6ef'
    };

    document.getElementById("response").innerHTML += "Submitting Credit Card payment...please wait<br/>";
    digitalRiverPayments.createSource(creditCardNumberComponent, payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "Credit Card Payment response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "Credit Card Payment response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err)  {
      console.error('createSource failed:', err);
    });
  }

  function submitStoredCreditCardPayment() {
    // Call CreateSource
    const payload = {
      "type": "creditCard",
      "usage": "single",
      "owner": owner,
      "amount": 100,
      "currency": "USD",
      "mandate": {
        "terms": "By storing your card..."
      }
    };

    document.getElementById("response").innerHTML += "Submitting STORED Credit Card payment...please wait<br/>";
    digitalRiverPayments.createStoredPayment(creditCardNumberComponent, payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "Credit Card Payment response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "Credit Card Payment response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err)  {
      console.error('createSource failed:', err);
    });
  }

  function submitCreditCardPaymentWith3DS() {
    // Call CreateSource
    const payload = {
      "type": "creditCard",
      "usage": "single",
      "owner": owner,
      "amount": 100,
      "currency": "EUR"
    };
    document.getElementById("response").innerHTML += "Submitting Credit Card payment with 3DS...please wait<br/>";
    digitalRiverPayments.createCreditCardSource('dec0f861-7411-44e3-a011-67dd6de0e6ef', creditCardNumberComponent, payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "Credit Card Payment response received error message: " + response.error.code + "" + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "Credit Card Payment response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err)  {
      console.error('createSource failed:', err);
    });
  }

  function submitIbpPayment() {
    // Call CreateSource
    const payload = {
      "type": "onlineBanking",
      "usage": "single",
      "owner": owner,
      "amount": 100,
      "currency": "EUR",
      "onlineBanking" : {
        "returnUrl" : window.location.href,
        "cancelUrl" : window.location.href,

      },
      "creditCard" : {

      }
    };

    document.getElementById("response").innerHTML += "Submitting IBP payment...please wait<br/>";
    digitalRiverPayments.createSource(ibpBanksComponent, payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "IBP Payment response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "IBP Payment response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err) {
      console.error('createSource failed:', err);
    });
  }

  function submitKonbiniPayment() {
    // Call CreateSource
    const payload = {
      "type": "konbini",
      "usage": "single",
      "owner": owner,
      "amount": 100,
      "currency": "JPY",
    };

    document.getElementById("response").innerHTML += "Submitting Konbini payment...please wait<br/>";
    digitalRiverPayments.createSource(konbiniComponent, payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "Konbini response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "Konbini response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err) {
      console.error('createSource failed:', err);
    });
  }

  function ddGetSource() {
    event.preventDefault();
    const payload = {
      "type": "directDebit",
      "owner": owner,
      "amount": 100,
      "currency": "EUR",
      "directDebit": {
        "returnUrl": window.location.href
      }
    };

    digitalRiverPayments.createSource(payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "Payment response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "Payment response: " + "" + JSON.stringify(response.source, null, '\t');
        var ddWindow = window.open(response.source.redirect.redirectUrl, 'directDebit');
      }
    }).catch(function (err) {
      console.error('createSource failed:', err);
    });
  }

  function wtGetSource() {
    event.preventDefault();
    const payload = {
      "type": "wireTransfer",
      "owner": owner,
      "amount": 100,
      "currency": "USD",
      "wireTransfer": {}
    };

    digitalRiverPayments.createSource(payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "Payment response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "Payment response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err) {
      console.error('createSource failed:', err);
    });
  }

  function commonGetSource(paymentType,currency) {
    event.preventDefault();

    const payload = {
      "type": paymentType,
      "owner": owner,
      "amount": 100,
      "currency": currency
    };

    if(paymentType == 'codJapan') {
      payload.codJapan = {
        "returnUrl": window.location.href
      }
    }else if(paymentType == 'payco') {
      payload.payco = {
        "returnUrl": window.location.href
      }
    }

    digitalRiverPayments.createSource(payload).then( function(response) {
      if(response.error) {
        document.getElementById("response").innerHTML += "Payment response received error: " + JSON.stringify(response, null, '\t');
      } else {
        document.getElementById("response").innerHTML += "Payment response: " + "" + JSON.stringify(response.source, null, '\t');
      }
    }).catch(function (err) {
      console.error('createSource failed:', err);
    });
  }

  function destroyField() {
    $('#creditCardPanel').empty();
    creditCardNumberComponent.destroy();
    creditCardNumberComponent = '';
  }

  function recreateField() {
    $('#creditCardPanel').append('<div class="col-md-6 mb-3 paymentElement"> <label>Credit Card Number</label> <div id="ccError" class="text-danger"><!--error messages will go here--></div>' +
            '<div class="ccIcons"> <i id="VISA" class="fab fa-cc-visa"></i> <i id="MASTERCARD" class="fab fa-cc-mastercard"></i> <i id="AMERICAN_EXPRESS" class="fab fa-cc-amex"></i>' +
            '<i id="DISCOVER" class="fab fa-cc-discover"></i> <i id="JCB" class="fab fa-cc-jcb"></i> <i id="DINERS_CLUB" class="fab fa-cc-diners-club"></i>' +
            ' </div> <div id="cardnumber" class="myCustomClass"></div></div>');
    creditCardEvents();
  }

  function updateFields(obj) {
    if(obj.value == 'KR') {
      $('#city').val('Seoul');
      $('#state').val('Jeju Do');
      $('#zip').val('100-011');
    } else if(obj.value == 'JP') {
      $('#city').val('Chiba');
      $('#state').val('Kyongsangnamdo');
      $('#zip').val('272-0138');
    } else if(obj.value == 'FR') {
      $('#city').val('Paris');
      $('#state').val('Ile-de-France');
      $('#zip').val('75001');
    } else {
      $('#city').val('');
      $('#state').val('');
      $('#zip').val('');
    }
  }

  function getDEBanks() {
    digitalRiverPayments.getOnlineBankingBanks('DE', 'EUR').then(function (result) {
      responseLog(JSON.stringify(result));
    }).catch(function(error) {
      responseLog(JSON.stringify(error))
    });
  }

  function complianceData() {
    $('#complianceMethod').empty();
    let entity = $('#bEntity').val();
    let locale = $('#locale').val();
    let result = digitalRiverPayments.Compliance.getDetails(entity, locale);
    $('#complianceMethod').append('<div><strong style="color:blue;">'+result.disclosure.businessEntity.name+'</strong> '+result.disclosure.resellerDisclosure.localizedText+'</div>');
    $('#complianceMethod').append('<a class="complianceLink" target="_blank" type="button" class="btn btn-info" href='+ result.disclosure.legalNotice.url +'>'+ result.disclosure.legalNotice.localizedText +'</a>');
    $('#complianceMethod').append('<a class="complianceLink" target="_blank" type="button" class="btn btn-info" href='+ result.disclosure.cookiePolicy.url +'>'+ result.disclosure.cookiePolicy.localizedText +'</a>');
    $('#complianceMethod').append('<a class="complianceLink" target="_blank" type="button" class="btn btn-info" href='+ result.disclosure.privacyPolicy.url +'>'+ result.disclosure.privacyPolicy.localizedText +'</a>');
    $('#complianceMethod').append('<a class="complianceLink" target="_blank" type="button" class="btn btn-info" href='+ result.disclosure.termsOfSale.url +'>'+ result.disclosure.termsOfSale.localizedText +'</a>');
    $('#complianceMethod').append('<a class="complianceLink complianceCancellationLink" target="_blank" type="button" class="btn btn-info" href='+ result.disclosure.cancellationRights.url +'>'+ result.disclosure.cancellationRights.localizedText +'</a>');
  }

  // TO Get session
  let shopperToken;
  const apiDomain = 'https://api.digitalriver.com';
  const testApiDomain = 'https://dispatch-test.digitalriver.com';
  const apiBasePath = apiDomain + '/v1/shoppers/me';
  const testApiBasePath = testApiDomain + '/v1/shoppers/me';
  const authString = 'Basic YWNjMjg2NDkzZDU1NDYyNWFkYTA1NWYzYWExN2YzYjQ6YmM0N2Y5YmNmYzBhNGViZmI4M2Q3Njg0YTdkYzRkNWY=';

  /**
   * Returns value stored in cookie
   * @param name {string}
   * @returns {string}
   */
  function getCookieValue(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length === 2) {
      return parts.pop().split(";").shift();
    } else {
      return "0";
    }
  }

  function getShopperAPIToken() {
    console.log('Getting shopper API Token');
    try {
      const cookieExists = document.cookie.split(';').filter(function(item) {
        return item.trim().indexOf('shopperToken=') === 0
      }).length;
      if (cookieExists) {
        shopperToken = getCookieValue('shopperToken');
        return Promise.resolve(shopperToken);
      } else {
        var options = {
          maxRedirects: 0,
          responseType: 'json',
          timeout: 10000,
          headers: {
            'Authorization': authString
          }
        };
        var url = testApiDomain + '/oauth20/token.json?';
        var data = 'grant_type=client_credentials';
        return axios.post(url, data, options).then(function (token) {
          console.log('Received shopper API Token', token);
          var date = new Date();
          date.setTime(date.getTime()+(24*60*60*1000));
          var expires = "; expires="+date.toGMTString();
          console.log({token: token});
          var cookie = 'shopperToken=' + token.data.access_token + expires;
          document.cookie = cookie;
          return token.data.access_token;
        });
      }
    } catch (e) {
      console.error('error!',e);
    }
  }

  function addToCart(productId) {
    return getShopperAPIToken().then(function (token) {
      console.log('token', token);
      var options = {
        maxRedirects: 0,
        responseType: 'json',
        timeout: 10000,
        headers: {
          'Authorization': 'bearer ' + token
        }
      };
      var url = testApiBasePath + '/carts/active?productId=' + productId;
      var data = 'grant_type=client_credentials';
      return axios.post(url, data, options)
              .then(function(response) {
                console.log('response.data.paymentSession',response.data.cart)
                sessionClientSecret = response.data.cart.paymentSession.id;
                return sessionClientSecret;
              })
              .catch(function(e) {
                console.log(e);
              });
    });
  }

  addToCart('5104504200').then(function (sessionId) {
    console.log('session id retrieved.', sessionId)
  }).catch(function (error) {
    console.error('error getting session', error)
  });

  const retrieveSourceDemo = function() {
    digitalRiverPayments.retrieveSource('430d4cdc-0d1e-4c48-9a0a-e1885bd5dda9','430d4cdc-0d1e-4c48-9a0a-e1885bd5dda9_b60db5db-0994-473c-bb02-e3e7c45c6913')
      .then(function(response) {
        responseLog(JSON.stringify(response));
      })

  }
  const retrieveBadSourceDemo = function() {
    digitalRiverPayments.retrieveSource('33','430d4cdc-0d1e-4c48-9a0a-e1885bd5dda9_b60db5db-0994-473c-bb02-e3e7c45c6913')
            .then(function(response) {
              responseLog(JSON.stringify(response));
            })

  }




</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
</body>
</html>